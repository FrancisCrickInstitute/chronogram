<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chronogram: Adaptive Data Casting for Pandemic Data Analysis • chronogram</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Chronogram: Adaptive Data Casting for Pandemic Data Analysis">
<meta name="description" content='A system to "cast" laboratory and clinical data into a tidy-like data structure. This allows rapid, intuititive integration of different data sources - for example, PCR, viral sequencing and participant symptom diaries - and bridges the gap between a laboratory information management system (LIMS) and a data structure to allow testing of biological hypotheses. A chronogram has a flexible design not limited to a particular pathogen, vaccine schedule, or experimental assays.'>
<meta property="og:description" content='A system to "cast" laboratory and clinical data into a tidy-like data structure. This allows rapid, intuititive integration of different data sources - for example, PCR, viral sequencing and participant symptom diaries - and bridges the gap between a laboratory information management system (LIMS) and a data structure to allow testing of biological hypotheses. A chronogram has a flexible design not limited to a particular pathogen, vaccine schedule, or experimental assays.'>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">chronogram</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="articles/chronogram.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/annotate_episodes.html">Annotating infection episodes</a></li>
    <li><a class="dropdown-item" href="articles/annotation.html">Chronogram annotation</a></li>
    <li><a class="dropdown-item" href="articles/assembly.html">Chronogram assembly</a></li>
    <li><a class="dropdown-item" href="articles/SQL_assembly.html">Chronogram assembly from SQL</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="chronogram">chronogram<a class="anchor" aria-label="anchor" href="#chronogram"></a>
</h1></div>
<!-- badges: start -->

<p>The goal of chronogram is to “cast” and annotate metadata, laboratory and clinical data into a tidy-like data structure. This bridges between a LIMS / database style data warehouse and data that is ready for interrogation to test biological hypotheses.</p>
<p>Chronogram was designed during the SARS-CoV-2 pandemic (2019-). However, it is pathogen, vaccine and symptoms agnostic. It can be adapted for any pathogen, studies that have several pathogens/vaccines combinations.</p>
<p>Chronogram uses tidyverse approaches for several reasons:</p>
<ul>
<li><p>the final aim is often <code>ggplot2</code></p></li>
<li><p>many <code>tidyverse</code> verbs are immediately useful on a chronogram object.</p></li>
<li><p>the wider <code>R/tidyverse/quarto/reproducible science</code> ecosystem tools offer valuable ways to extend.</p></li>
<li><p>within our teams, scientist and clinicians with some coding experience frequently target <code>R/tidyverse</code></p></li>
</ul>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of chronogram from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 1. Setup R and git ####</span></span>
<span><span class="co"># install.packages("usethis")</span></span>
<span><span class="co"># install.packages("credentials")</span></span>
<span></span>
<span><span class="co"># Replace:</span></span>
<span><span class="co">## - XXXX with your github username</span></span>
<span><span class="co">## - YYYY@ZZZZ with the email address you use for github</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_git_config</span><span class="op">(</span>user.name <span class="op">=</span> <span class="st">"XXXX"</span>, user.email <span class="op">=</span> <span class="st">"YYYY@ZZZZ"</span><span class="op">)</span></span>
<span> </span>
<span><span class="co"># Go to github page to generate token</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">create_github_token</span><span class="op">(</span><span class="op">)</span></span>
<span> </span>
<span><span class="co"># paste your PAT into pop-up that follows...</span></span>
<span><span class="fu">credentials</span><span class="fu">::</span><span class="fu">set_github_pat</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## ^ above only needs running once for R and git to interact</span></span>
<span></span>
<span><span class="co">## 2. Install package itself ####</span></span>
<span></span>
<span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"FrancisCrickInstitute/chronogram"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-problem">The problem<a class="anchor" aria-label="anchor" href="#the-problem"></a>
</h2>
<p>Immunology studies of vaccine responses are traditionally designed as follows:</p>
<ul>
<li>matched cohort vaccinated on the same day</li>
<li>return visits on the same subsequent day</li>
<li>assays performed on samples from matched visit days</li>
</ul>
<p>This study design is shown below (left). There is a single vaccine dose (d0) and 3 visits: baseline and 2 follow-up visits at d7 and d14. The resulting data can be compiled into a simple data structure (below, right): individuals are rows, there are a few columns of metadata (age, sex, etc) and then the two assays are reported as columns: assay 1 {visit 1, visit 2, visit 3}; assay 2 {visit 1, visit 2, visit 3}.</p>
<p><img src="reference/figures/README-conundrum-1.png" width="100%"></p>
<p>In observational cohort studies, particularly in pandemic settings, this is inadequate for immunology studies conducted pragmatically, where vaccine dates, available samples, and dates of additional doses can (and will!) change. An example real-world study is shown here:</p>
<p><img src="reference/figures/README-real_world-1.png" width="100%"></p>
<p>Many studies will have massive datasets, stored as an SQL database or equivalent LIMS solutions. These are great ways to store and maintain source data, but do not allow the user - particularly a biologist - to “place” the results in their full immunological context: that participant’s prior exposures to vaccines and infections. This is the problem the chronogram package solves.</p>
</div>
<div class="section level2">
<h2 id="the-solution">The solution<a class="anchor" aria-label="anchor" href="#the-solution"></a>
</h2>
<p>A chronogram is a hidden date often within an inscription, for example on a headstone, and often with Roman numerals doubling as Roman characters. We adopted the name for this package, as it helps to find the hidden immunological meaning with dates.</p>
<p>Below is a sketch of a real-world study after a single vaccine dose (top). Now, we have arranged the resulting data in a chronogram format (bottom), where data is structured in a ‘long format’ with each row presented a specific date for an individual. Metadata (grey) is repeated on each row. The experimental data are only stored against the relevant date of sampling.</p>
<p><img src="reference/figures/README-resolution_1-1.png" width="100%"></p>
<p>Chronogram’s date-centric design allows users to integrate and interrogate data, which would otherwise be hidden (or at least hard to find) in traditional formats. For example, if you were examining responses to vaccines 9-12d after the dose, the traditional model would indiscriminately say “visit 3 is closest, use that set”. In contrast, chronogram allows a relevant slice of the data (green box) to be taken rapidly, with the date of dose stored in the metadata columns (grey).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slice.of.data</span> <span class="op">&lt;-</span> <span class="va">chrono</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">calendar_date</span> <span class="op">&gt;</span> <span class="va">date_dose_1</span> <span class="op">+</span> <span class="fl">9</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">calendar_date</span> <span class="op">&lt;</span> <span class="va">date_dose_1</span> <span class="op">+</span> <span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-application-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="the-real-world-solution">The real world solution<a class="anchor" aria-label="anchor" href="#the-real-world-solution"></a>
</h2>
<p>Because it is date-aware, chronogram also allows the user to assemble any date-varying data: - dates of positive PCR results (or dates of negative PCRs from occupational screening); - S gene target failure (or presence); - viral sequencing results; symptoms; - additional doses</p>
<p>To illustrate, let’s add some infections to our example study. An observational study will never have same-day infections across the cohort, so in the real world infection data always requires this kind of approach.</p>
<p>Now participant 001 has a positive PCR at day 50, with S gene target failure, and participant 002 has a positive PCR at day 40 with S gene presence.</p>
<p><img src="reference/figures/README-real_world_infections-1.png" width="100%"></p>
<p>And here is the same data cast into chronogram structure</p>
<p><img src="reference/figures/README-real_world_resolution_1-1.png" width="100%"></p>
<p>Our biological question in this example is how waning from first vaccination proceeds over 2 months. For 001 and 002, their last visit is unhelpful, as they have had a boost from additional encounter with antigen (an infection). Here we can slice something like this:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## get a list of unhelpful participants ##</span></span>
<span><span class="va">unhelpful.participants</span> <span class="op">&lt;-</span> <span class="va">chrono</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">ID</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">PCR</span>, <span class="st">"pos"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## make the selection ##</span></span>
<span><span class="va">slice.of.data</span> <span class="op">&lt;-</span> <span class="va">chrono</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">## filter ##</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">unhelpful.participants</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">## window ##</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">calendar_date</span> <span class="op">&gt;</span> <span class="va">date_dose_1</span> <span class="op">+</span> <span class="fl">60</span><span class="op">)</span></span></code></pre></div>
<p>This keeps 003’s data (green box), and ignores 001 and 002’s data (red boxes).</p>
<p><img src="reference/figures/README-application_real_world-1.png" width="100%"></p>
<p><code>Chronogram</code> contains a suite of functions to annotate chronograms, which we recommend running immediately after assembly. These annotations include the number of doses, and number of infections, so it is even more straightforward to select, for example:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">annotated.chrono</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">number_of_infections</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>The annotation function <code><a href="reference/cg_annotate_episodes_find.html">cg_annotate_episodes_find()</a></code> searches for a user-specified number of days earlier (and later), to gather symptoms, tests, sequencing that might occur on different days but are really a single episode of infection. <code><a href="reference/cg_annotate_episodes_count.html">cg_annotate_episodes_count()</a></code> converts this into a count.</p>
<p>Check out the vignettes for more info.</p>
<p>Many of the examples use a SARS-CoV-2-like scenario of testing, vaccines etc, however you could use chronogram to manage any kind of vaccine response (+exposure) data for any pathogen(s).</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing chronogram</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Edward Carr <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-9343-4593" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>David Greenwood <br><small class="roles"> Author </small>  </li>
<li>Marianne Shawe-Taylor <br><small class="roles"> Author </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="https://img.shields.io/badge/lifecycle-stable-brightgreen.svg" alt="Lifecycle: stable"></a></li>
<li><a href="https://github.com/FrancisCrickInstitute/chronogram/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/FrancisCrickInstitute/chronogram/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Edward Carr, David Greenwood, Marianne Shawe-Taylor.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
