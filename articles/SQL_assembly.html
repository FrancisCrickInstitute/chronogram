<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chronogram assembly from SQL • chronogram</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Chronogram assembly from SQL">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">chronogram</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/chronogram.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/annotate_episodes.html">Annotating infection episodes</a></li>
    <li><a class="dropdown-item" href="../articles/annotation.html">Chronogram annotation</a></li>
    <li><a class="dropdown-item" href="../articles/assembly.html">Chronogram assembly</a></li>
    <li><a class="dropdown-item" href="../articles/SQL_assembly.html">Chronogram assembly from SQL</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Chronogram assembly from SQL</h1>
            
      

      <div class="d-none name"><code>SQL_assembly.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://franciscrickinstitute.github.io/chronogram/">chronogram</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbplyr.tidyverse.org/" class="external-link">dbplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dbplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     ident, sql</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rsqlite.r-dbi.org" class="external-link">RSQLite</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Here we build a chronogram from an SQL database. We use an example
derived from the de-identified PITCH dataset available here, under a
CC-BY-4.0 licence: <a href="https://data.mendeley.com/datasets/fyp26zjgmj/1" class="external-link uri">https://data.mendeley.com/datasets/fyp26zjgmj/1</a>
Published: 3 November 2021, DOI: 10.17632/fyp26zjgmj.1. Contributors:
Rebecca Payne, Susan Hopkins, Victoria Hall, Christina Dold, Christopher
Duncan, Alex Richter, Miles Carroll, Gavin Screaton, Thushan de Silva,
Lance Turtle, Paul Klenerman, Susanna Dunachie, PITCH Consortium
authors. The dataset supports Payne et al. <strong>Immunogenicity of
standard and extended dosing intervals of BNT162b2 mRNA vaccine</strong>
<em>Cell</em> 2021</p>
<blockquote>
<p><strong>NOTE</strong></p>
<p>Changes have been made to the de-identified public dataset (DOI:
10.17632/fyp26zjgmj.1).</p>
<ol style="list-style-type: lower-roman">
<li><p>the public data reports dates as MM/YYYY. To build a chronogram
we have assigned randomly from 1-28 for DD in DD/MM/YYYY for dose 1, and
used the available intervals in days to place the remaining data in date
time. For illustration purposes, we need plausible DD/MM/YYYY dates -
they are not real.</p></li>
<li><p>not all of the public dataset has been used in this example (some
assays not included).</p></li>
</ol>
<p>If your motivation is to re-analyse Payne et al. for scientific
reasons, do not use the example dataset in this package. Instead consult
the de-identified Mendeley data (DOI: 10.17632/fyp26zjgmj.1), or the
Cell manuscript’s data and code availability statement.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="approach">Approach<a class="anchor" aria-label="anchor" href="#approach"></a>
</h2>
<p>Use <code>dbplyr</code> to extract the relevant tibbles from an
existing SQL database. These extracted tibbles are assembled with the
chronogram constructor functions.</p>
<blockquote>
<p><strong>Reminder</strong></p>
<p>There are five required inputs:</p>
<ol style="list-style-type: decimal">
<li><p>a list of participant or study IDs</p></li>
<li><p>a start date</p></li>
<li><p>an end date</p></li>
<li><p>some metadata, stored against the identifier in #1.</p></li>
<li><p>Experimental data, stored against the identifier in #1 and a date
of sample.</p></li>
</ol>
<p><em>1-3 are straightforward, so we start with 4</em></p>
</blockquote>
<div class="section level3">
<h3 id="connect-to-sql-db">Connect to SQL db<a class="anchor" aria-label="anchor" href="#connect-to-sql-db"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Connect to the sql database ##</span></span>
<span><span class="co">## here we use the shipped example database</span></span>
<span><span class="va">db_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"extdata"</span>, <span class="st">"pitch-database-output.sqlite"</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"chronogram"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## R covers most types of SQL. Here, we use SQLite.</span></span>
<span><span class="va">pitch_db</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">db_file</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dbplyr</span><span class="fu">::</span><span class="fu"><a href="https://dbplyr.tidyverse.org/reference/src_dbi.html" class="external-link">src_dbi</a></span><span class="op">(</span><span class="va">pitch_db</span><span class="op">)</span></span>
<span><span class="co">#&gt; src:  sqlite 3.46.0 [/home/runner/work/_temp/Library/chronogram/extdata/pitch-database-output.sqlite]</span></span>
<span><span class="co">#&gt; tbls: metadata, MSD_data, MSD.data, nAb_data, nAb.data, sqlite_stat1,</span></span>
<span><span class="co">#&gt;   sqlite_stat4</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="get-metadata">Get metadata<a class="anchor" aria-label="anchor" href="#get-metadata"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span></span>
<span>  <span class="va">pitch_db</span>,</span>
<span>  <span class="co">## give the name of the SQL table below ##</span></span>
<span>  <span class="st">"metadata"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [6 x 6]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: sqlite 3.46.0 [/home/runner/work/_temp/Library/chronogram/extdata/pitch-database-output.sqlite]</span></span></span>
<span><span class="co">#&gt;      ID Centre_code Previous_infection Vaccine_interval dose_1_date dose_2_date</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">4</span>001           4 Y                  LONG                   <span style="text-decoration: underline;">18</span>608       <span style="text-decoration: underline;">18</span>692</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">4</span>002           4 Y                  SHORT                  <span style="text-decoration: underline;">18</span>650       <span style="text-decoration: underline;">18</span>681</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">4</span>003           4 Y                  LONG                   <span style="text-decoration: underline;">18</span>612       <span style="text-decoration: underline;">18</span>682</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">4</span>004           4 Y                  LONG                   <span style="text-decoration: underline;">18</span>624       <span style="text-decoration: underline;">18</span>695</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">4</span>005           4 Y                  LONG                   <span style="text-decoration: underline;">18</span>623       <span style="text-decoration: underline;">18</span>728</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  <span style="text-decoration: underline;">4</span>006           4 N                  LONG                   <span style="text-decoration: underline;">18</span>655       <span style="text-decoration: underline;">18</span>704</span></span></code></pre></div>
<p>The above leaves the data itself in the SQL db, but routes it through
R to print the first few rows. For very large databases, where
significant up-front filtering can take place, then most tidyverse verbs
work here. For example, let’s restrict the metadata participants from a
single centre.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata_filt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span></span>
<span>  <span class="va">pitch_db</span>,</span>
<span>  <span class="co">## give the name of the SQL table below ##</span></span>
<span>  <span class="st">"metadata"</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Centre_code</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">metadata_filt</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [6 x 6]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: sqlite 3.46.0 [/home/runner/work/_temp/Library/chronogram/extdata/pitch-database-output.sqlite]</span></span></span>
<span><span class="co">#&gt;      ID Centre_code Previous_infection Vaccine_interval dose_1_date dose_2_date</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">1</span>001           1 Y                  LONG                   <span style="text-decoration: underline;">18</span>653       <span style="text-decoration: underline;">18</span>718</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">1</span>002           1 Y                  LONG                   <span style="text-decoration: underline;">18</span>637       <span style="text-decoration: underline;">18</span>708</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">1</span>003           1 Y                  LONG                   <span style="text-decoration: underline;">18</span>602       <span style="text-decoration: underline;">18</span>658</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">1</span>004           1 Y                  LONG                   <span style="text-decoration: underline;">18</span>638       <span style="text-decoration: underline;">18</span>709</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">1</span>005           1 Y                  LONG                   <span style="text-decoration: underline;">18</span>652       <span style="text-decoration: underline;">18</span>715</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  <span style="text-decoration: underline;">1</span>007           1 Y                  LONG                   <span style="text-decoration: underline;">18</span>629       <span style="text-decoration: underline;">18</span>692</span></span></code></pre></div>
<p>See the dbplyr documentation for further info: <a href="https://dbplyr.tidyverse.org/index.html" class="external-link uri">https://dbplyr.tidyverse.org/index.html</a> .</p>
<p>As our example is small, we want to move all the data into R, to do
this use <code>dbplyr::collect()</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span></span>
<span>  <span class="va">pitch_db</span>,</span>
<span>  <span class="co">## give the name of the SQL table below ##</span></span>
<span>  <span class="st">"metadata"</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">metadata</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 587 × 6</span></span></span>
<span><span class="co">#&gt;       ID Centre_code Previous_infection Vaccine_interval dose_1_date dose_2_date</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">4</span>001           4 Y                  LONG                   <span style="text-decoration: underline;">18</span>608       <span style="text-decoration: underline;">18</span>692</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">4</span>002           4 Y                  SHORT                  <span style="text-decoration: underline;">18</span>650       <span style="text-decoration: underline;">18</span>681</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">4</span>003           4 Y                  LONG                   <span style="text-decoration: underline;">18</span>612       <span style="text-decoration: underline;">18</span>682</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">4</span>004           4 Y                  LONG                   <span style="text-decoration: underline;">18</span>624       <span style="text-decoration: underline;">18</span>695</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">4</span>005           4 Y                  LONG                   <span style="text-decoration: underline;">18</span>623       <span style="text-decoration: underline;">18</span>728</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">4</span>006           4 N                  LONG                   <span style="text-decoration: underline;">18</span>655       <span style="text-decoration: underline;">18</span>704</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">4</span>007           4 Y                  LONG                   <span style="text-decoration: underline;">18</span>603       <span style="text-decoration: underline;">18</span>674</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">4</span>008           4 Y                  LONG                   <span style="text-decoration: underline;">18</span>607       <span style="text-decoration: underline;">18</span>708</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">4</span>009           4 Y                  LONG                   <span style="text-decoration: underline;">18</span>606       <span style="text-decoration: underline;">18</span>677</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">4</span>010           4 Y                  LONG                   <span style="text-decoration: underline;">18</span>607       <span style="text-decoration: underline;">18</span>678</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 577 more rows</span></span></span></code></pre></div>
<div class="section level4">
<h4 id="clean-metadata">Clean metadata<a class="anchor" aria-label="anchor" href="#clean-metadata"></a>
</h4>
<p>The <code>dose_1_date</code> and <code>dose_2_date</code> columns
have lost their DD-MM-YYYY formatting when the SQL db was constructed.
Fix:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="va">metadata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span>, <span class="op">~</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">.x</span>, origin <span class="op">=</span> <span class="st">"1970-01-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## show the relevant columns ##</span></span>
<span><span class="va">metadata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ID</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;      ID dose_1_date dose_2_date</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">4</span>001 2020-12-12  2021-03-06 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">4</span>002 2021-01-23  2021-02-23 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">4</span>003 2020-12-16  2021-02-24 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">4</span>004 2020-12-28  2021-03-09 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">4</span>005 2020-12-27  2021-04-11 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  <span style="text-decoration: underline;">4</span>006 2021-01-28  2021-03-18</span></span></code></pre></div>
<p>Precisely what cleaning is needed will be study specific.</p>
</div>
</div>
<div class="section level3">
<h3 id="list-of-participant-ids">List of participant IDs<a class="anchor" aria-label="anchor" href="#list-of-participant-ids"></a>
</h3>
<p>Extract this from the SQL’s master table (in our example, that’s
metadata table).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">studyId</span> <span class="op">&lt;-</span> <span class="va">metadata</span><span class="op">$</span><span class="va">ID</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="start-and-end-date">Start and end date<a class="anchor" aria-label="anchor" href="#start-and-end-date"></a>
</h3>
<p>We can use 1st Jan 2020 (i.e. pre-pandemic) as the start date, and
the date of publication as the end date.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## provide dates as character vectors DDMMYYYY ##</span></span>
<span><span class="va">start_date</span> <span class="op">&lt;-</span> <span class="st">"01012020"</span></span>
<span><span class="va">end_date</span> <span class="op">&lt;-</span> <span class="st">"03112021"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="experimental-data">Experimental data<a class="anchor" aria-label="anchor" href="#experimental-data"></a>
</h3>
<p>As we have a small study, and want to import all into a chronogram
format, we can `collect()` the relevant SQL table, fix formatting and
then be ready for chronogram assembly.</p>
<p>For a large study where you only want a subset of the available SQL
data, consider filtering to a smaller selection of participants, using a
similar approach as for `metadata_filt` above.</p>
<p>For extremely large studies, several stages of chronogram assembly
and annotation can be computationally expensive. Building a chronogram
from massive studies (&gt;40,000 participants, &gt;2 years) fails on
“lab issued” laptops. However, enough metadata can be pulled into R to
select the participants relevant to a given analysis, so an
analysis-relevant chronogram can be build. If the entirety of a massive
study is required, the first option is to swap to a high-performance
compute cluster (or a high end desktop). The second option, is to break
the task into smaller components, and this is best performed by building
and annotating chronograms for ~5000 individuals (so total number of
rows &lt; ~ 1,000,000), and writing each to disk with subsequent
windowing, filtering, and selecting the chronograms in parallel. A third
approach is to take the spirit of this package and push the
computational work to the SQL server. This would likely require a
solution specific to that study’s SQL flavour, assumes the server has
compute capacity (and the user permissions to utilise), and supporting
SQL to that degree (for example, tidyverse verbs are variably translated
to SQL flavours) is currently beyond the scope of this package and our
team. We welcome hearing from users about their approaches with larger
studies.</p>
<div class="section level4">
<h4 id="neutralisation-data">Neutralisation data<a class="anchor" aria-label="anchor" href="#neutralisation-data"></a>
</h4>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Collect the experimental data from SQL ##</span></span>
<span><span class="va">nAb_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span></span>
<span>  <span class="va">pitch_db</span>,</span>
<span>  <span class="co">## give the name of the SQL table below ##</span></span>
<span>  <span class="st">"nAb_data"</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## Again, the date needs re-formatting ##</span></span>
<span><span class="va">nAb_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;      ID calendar_date Victoria  Beta Gamma Delta</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>   561         <span style="text-decoration: underline;">18</span>813       10    10    46 10   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>   568         <span style="text-decoration: underline;">18</span>744       10    10    10 10   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>   447         <span style="text-decoration: underline;">18</span>679       92    10   132 10   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>   557            <span style="color: #BB0000;">NA</span>      115    10   290 10   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>   564         <span style="text-decoration: underline;">18</span>729       10    10    24 10   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>   581         <span style="text-decoration: underline;">18</span>715       46    10    43 10</span></span>
<span></span>
<span><span class="va">nAb_data</span> <span class="op">&lt;-</span> <span class="va">nAb_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span>, <span class="op">~</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">.x</span>, origin <span class="op">=</span> <span class="st">"1970-01-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="msd-data">MSD data<a class="anchor" aria-label="anchor" href="#msd-data"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Collect the experimental data from SQL ##</span></span>
<span><span class="va">MSD_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span></span>
<span>  <span class="va">pitch_db</span>,</span>
<span>  <span class="co">## give the name of the SQL table below ##</span></span>
<span>  <span class="st">"MSD_data"</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## Again, the date needs re-formatting ##</span></span>
<span><span class="va">MSD_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 14</span></span></span>
<span><span class="co">#&gt;      ID Cov2_RBD_MSD Cov2_RBD_BAU Cov_2N_MSD Cov_2N_BAU Cov_2S_MSD Cov_2S_BAU</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     2       <span style="text-decoration: underline;">78</span>191.        <span style="text-decoration: underline;">2</span>127.      170.       0.402    <span style="text-decoration: underline;">164</span>133.      <span style="text-decoration: underline;">1</span>480.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     3        <span style="text-decoration: underline;">6</span>694.         182.       52.7      0.124     <span style="text-decoration: underline;">14</span>510.       131.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     5      <span style="text-decoration: underline;">559</span>384.       <span style="text-decoration: underline;">15</span>215.     <span style="text-decoration: underline;">4</span>692.      11.1      <span style="text-decoration: underline;">912</span>009.      <span style="text-decoration: underline;">8</span>221.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     5       <span style="text-decoration: underline;">11</span>600.         316.     <span style="text-decoration: underline;">5</span>261.      12.4       <span style="text-decoration: underline;">28</span>710.       259.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5      <span style="text-decoration: underline;">310</span>782.        <span style="text-decoration: underline;">8</span>453.     <span style="text-decoration: underline;">2</span>072.       4.89     <span style="text-decoration: underline;">531</span>463.      <span style="text-decoration: underline;">4</span>791.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     8       <span style="text-decoration: underline;">88</span>388.        <span style="text-decoration: underline;">2</span>404.     <span style="text-decoration: underline;">7</span>323.      17.3      <span style="text-decoration: underline;">217</span>099.      <span style="text-decoration: underline;">1</span>957.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7 more variables: HKU1_S &lt;dbl&gt;, MERS_S &lt;dbl&gt;, NL63_S &lt;dbl&gt;, OC43_S &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   X229E_S &lt;dbl&gt;, Cov_1S &lt;dbl&gt;, calendar_date &lt;dbl&gt;</span></span></span>
<span></span>
<span><span class="va">MSD_data</span> <span class="op">&lt;-</span> <span class="va">MSD_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span>, <span class="op">~</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">.x</span>, origin <span class="op">=</span> <span class="st">"1970-01-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="assemble-chronogram">Assemble chronogram<a class="anchor" aria-label="anchor" href="#assemble-chronogram"></a>
</h3>
<p>Now we have the relevant objects in memory and cleaned, we can
assemble a chronogram.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pitch_chronogram_skeleton</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chronogram_skeleton.html">chronogram_skeleton</a></span><span class="op">(</span></span>
<span>  ids <span class="op">=</span> <span class="va">studyId</span>,</span>
<span>  start_date <span class="op">=</span> <span class="va">start_date</span>,</span>
<span>  end_date <span class="op">=</span> <span class="va">end_date</span>,</span>
<span>  col_ids <span class="op">=</span> <span class="va">ID</span>,</span>
<span>  col_calendar_date <span class="op">=</span> <span class="va">calendar_date</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pitch_chronogram</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chronogram.html">chronogram</a></span><span class="op">(</span></span>
<span>  <span class="va">pitch_chronogram_skeleton</span>, <span class="va">metadata</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pitch_chronogram</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cg_add_experiment.html">cg_add_experiment</a></span><span class="op">(</span></span>
<span>  <span class="va">pitch_chronogram</span>,</span>
<span>  <span class="va">nAb_data</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pitch_chronogram</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cg_add_experiment.html">cg_add_experiment</a></span><span class="op">(</span></span>
<span>  <span class="va">pitch_chronogram</span>,</span>
<span>  <span class="va">MSD_data</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pitch_chronogram</span></span>
<span><span class="co">#&gt; A chronogram:</span></span>
<span><span class="co">#&gt;  Dates column:  calendar_date </span></span>
<span><span class="co">#&gt;  IDs column:    ID </span></span>
<span><span class="co">#&gt;  Starts on:     2020-01-01 </span></span>
<span><span class="co">#&gt;  Ends on:       2021-11-03 </span></span>
<span><span class="co">#&gt;  Contains:      587  unique participant IDs</span></span>
<span><span class="co">#&gt;  Windowed:      FALSE </span></span>
<span><span class="co">#&gt;  Spanning:      673 - 673 days [min-max per participant]</span></span>
<span><span class="co">#&gt;  Metadata:      Centre_code, Previous_infection, Vaccine_interval, dose_1_date, dose_2_date </span></span>
<span><span class="co">#&gt;  Size:          64.84 MB </span></span>
<span><span class="co">#&gt;  Pkg_version:   1.0.0 [used to build this cg]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 395,051 × 23</span></span></span>
<span><span class="co">#&gt;    calendar_date ID    Centre_code Previous_infection Vaccine_interval</span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2020-01-01    100             0 Y                  LONG            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2020-01-02    100             0 Y                  LONG            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2020-01-03    100             0 Y                  LONG            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2020-01-04    100             0 Y                  LONG            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2020-01-05    100             0 Y                  LONG            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2020-01-06    100             0 Y                  LONG            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2020-01-07    100             0 Y                  LONG            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2020-01-08    100             0 Y                  LONG            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2020-01-09    100             0 Y                  LONG            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2020-01-10    100             0 Y                  LONG            </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 395,041 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 18 more variables: dose_1_date &lt;date&gt;, dose_2_date &lt;date&gt;, Victoria &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Beta &lt;int&gt;, Gamma &lt;int&gt;, Delta &lt;chr&gt;, Cov2_RBD_MSD &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Cov2_RBD_BAU &lt;dbl&gt;, Cov_2N_MSD &lt;dbl&gt;, Cov_2N_BAU &lt;dbl&gt;, Cov_2S_MSD &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Cov_2S_BAU &lt;dbl&gt;, HKU1_S &lt;dbl&gt;, MERS_S &lt;dbl&gt;, NL63_S &lt;dbl&gt;, OC43_S &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   X229E_S &lt;dbl&gt;, Cov_1S &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="annotate-chronogram-and-analyse">Annotate chronogram and analyse<a class="anchor" aria-label="anchor" href="#annotate-chronogram-and-analyse"></a>
</h3>
<p>Now that assembly is complete the next step is to annotate the
chronogram (find and label infection episodes, count the number of
exposures from vaccination, infection and in total). Check out the
annotation vignettes for usage examples.</p>
<p>Let’s plot some results from the un-annotated PITCH dataset.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pitch_chronogram</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Cov_2S_MSD</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">calendar_date</span>, y <span class="op">=</span> <span class="va">Cov_2S_MSD</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">20</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">Previous_infection</span> <span class="op">+</span> <span class="va">Vaccine_interval</span>,</span>
<span>    labeller <span class="op">=</span> <span class="st">"label_both"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>main <span class="op">=</span> <span class="st">"SARS-CoV-2 Spike binding Ab"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SQL_assembly_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## -----</span></span>
<span><span class="va">pitch_chronogram</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">OC43_S</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">calendar_date</span>, y <span class="op">=</span> <span class="va">OC43_S</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">20</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">Previous_infection</span> <span class="op">+</span> <span class="va">Vaccine_interval</span>,</span>
<span>    labeller <span class="op">=</span> <span class="st">"label_both"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>main <span class="op">=</span> <span class="st">"OC43 [a common coronavirus] Spike binding Ab"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SQL_assembly_files/figure-html/unnamed-chunk-14-2.png" width="672"></p>
<p>As expected - SARS-CoV-2 binding IgG is boosted by Covid vaccination,
whereas binding IgG against OC43’s spike is not boosted by Covid
vaccination.</p>
<blockquote>
<p><strong>NOTE</strong></p>
<p>As highlighted earlier, changes have been made to the de-identified
public dataset (DOI: 10.17632/fyp26zjgmj.1).</p>
<p>If your motivation is to re-analyse Payne et al. for scientific
reasons, do not use the example dataset in this package. Instead consult
the de-identified Mendeley data (DOI: 10.17632/fyp26zjgmj.1), and the
data and code availability statement of Payne et
al. <strong>Immunogenicity of standard and extended dosing intervals of
BNT162b2 mRNA vaccine</strong> <em>Cell</em> 2021.</p>
</blockquote>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>This vignette shows a stepwise approach to move data from SQL to
chronogram. Whilst the clean-up code is study/database specific, it is
re-usable throughout that study. We suggest combining the equivalent
code for your study into an Rscript - or series of Rscripts - to run
non-interactively, for example whilst you’re off for coffee or as a
scheduled task.</p>
</div>
<div class="section level2">
<h2 id="sessioninfo">SessionInfo<a class="anchor" aria-label="anchor" href="#sessioninfo"></a>
</h2>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.4.1 (2024-06-14)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 22.04.4 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] ggplot2_3.5.1    RSQLite_2.3.7    DBI_1.2.3        dbplyr_2.5.0    </span></span>
<span><span class="co">#&gt; [5] dplyr_1.1.4      chronogram_1.0.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] tidyr_1.3.1       sass_0.4.9        utf8_1.2.4        generics_0.1.3   </span></span>
<span><span class="co">#&gt;  [5] digest_0.6.36     magrittr_2.0.3    timechange_0.3.0  evaluate_0.24.0  </span></span>
<span><span class="co">#&gt;  [9] grid_4.4.1        fastmap_1.2.0     blob_1.2.4        lobstr_1.1.2     </span></span>
<span><span class="co">#&gt; [13] jsonlite_1.8.8    purrr_1.0.2       fansi_1.0.6       scales_1.3.0     </span></span>
<span><span class="co">#&gt; [17] textshaping_0.4.0 jquerylib_0.1.4   cli_3.6.3         rlang_1.1.4      </span></span>
<span><span class="co">#&gt; [21] bit64_4.0.5       munsell_0.5.1     withr_3.0.0       cachem_1.1.0     </span></span>
<span><span class="co">#&gt; [25] yaml_2.3.9        tools_4.4.1       memoise_2.0.1     colorspace_2.1-0 </span></span>
<span><span class="co">#&gt; [29] vctrs_0.6.5       R6_2.5.1          lifecycle_1.0.4   lubridate_1.9.3  </span></span>
<span><span class="co">#&gt; [33] fs_1.6.4          bit_4.0.5         ragg_1.3.2        pkgconfig_2.0.3  </span></span>
<span><span class="co">#&gt; [37] desc_1.4.3        pkgdown_2.1.0     pillar_1.9.0      bslib_0.7.0      </span></span>
<span><span class="co">#&gt; [41] gtable_0.3.5      glue_1.7.0        systemfonts_1.1.0 highr_0.11       </span></span>
<span><span class="co">#&gt; [45] xfun_0.45         tibble_3.2.1      tidyselect_1.2.1  knitr_1.48       </span></span>
<span><span class="co">#&gt; [49] farver_2.1.2      htmltools_0.5.8.1 rmarkdown_2.27    compiler_4.4.1</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Edward Carr, David Greenwood, Marianne Shawe-Taylor.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
